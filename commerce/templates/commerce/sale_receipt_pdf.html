{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Quittung #{{ sale.id }}</title>
    <style>
        /* A4 Page Setup */
        @page {
            size: A4;
            margin: 2cm;
            @frame footer {
                -pdf-frame-content: footer-content;
                bottom: 0cm;
                margin-left: 2cm;
                margin-right: 2cm;
                height: 1cm;
            }
        }
        
        /* TYPOGRAPHY */
        body {
            font-family: Helvetica, sans-serif; 
            font-size: 10pt;
            color: #333;
            line-height: 1.3;
        }

        /* HEADER TABLE */
        table.header-table {
            width: 100%;
            margin-bottom: 5px;
            border: none;
        }
        td.logo-cell {
            width: 50%;
            vertical-align: top;
            /* Font-Size entfernt, da Bild genutzt wird */
        }
        td.address-cell {
            width: 50%;
            text-align: right;
            vertical-align: top;
            font-size: 9pt;
            color: #555;
        }
        .company-name {
            font-weight: bold;
            font-size: 10pt;
            color: #333;
            margin-bottom: 2px;
        }

        /* INFO TABLE */
        table.info-table {
            width: 100%;
            margin-bottom: 0; /* Abstand wird durch items-table margin erzeugt */
            font-size: 9pt;
            border: none;
        }
        .info-label {
            font-weight: bold;
            color: #aa8684;
            font-size: 8pt;
            text-transform: uppercase;
        }

        /* ITEMS TABLE */
        table.items-table {
            width: 100%;
            border-collapse: collapse;
            /* HIER: 2cm Abstand nach oben wie gewünscht */
            margin-top: 20mm; 
            font-size: 9pt;
        }
        .items-table th {
            color: #aa8684;
            border-bottom: 1px solid #aa8684;
            padding: 5px 2px;
            text-align: left; /* Default links */
            font-weight: bold;
            text-transform: uppercase;
            font-size: 8pt;
        }
        /* Spezifische Ausrichtung für THs mit Klasse text-right */
        .items-table th.text-right {
            text-align: right;
        }
        
        .items-table td {
            border-bottom: 1px solid #eee; 
            padding: 6px 2px;
            vertical-align: top;
        }
        
        /* ALIGNMENT HELPERS */
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        
        /* SUMMARY STYLES */
        .summary-row td {
            border-bottom: 1px solid #eee;
            padding: 4px 2px;
        }
        .summary-total-cell {
            border-top: 1px solid #aa8684; 
            border-bottom: 3px double #aa8684; 
            font-weight: bold;
            font-size: 11pt;
            color: #333;
            padding-top: 5px;
            padding-bottom: 5px;
        }
    </style>
</head>
<body>

    <!-- FOOTER CONTENT -->
    <div id="footer-content">
        <!-- Robuste Trennlinie für den Footer -->
        <hr style="color: #ddd; background-color: #ddd; height: 1px; border: 0; margin-bottom: 5px;">
        <p style="text-align: center; font-size: 8pt; color: #aa8684; margin: 0;">
            Danke für Ihren Einkauf bei Support Elle.<br>
            Es gelten unsere AGB.
        </p>
    </div>

    <!-- HEADER BLOCK -->
    <table class="header-table">
        <tr>
            <td class="logo-cell">
                <!-- LOGO EINBINDUNG -->
                <!-- Stellen Sie sicher, dass 'core/static/img/logo.png' existiert -->
                <img src="{% static 'img/SupportElle_Logo-4.webp' %}" alt="SupportElle" style="height: 200px; width: auto;">
            </td>
            <td class="address-cell">
                <div class="company-name">Support Elle (by Mileja GmbH)</div>
                Rittergasse 20<br>
                CH-4051 Basel<br>
                UID: CHE-170.569.062<br>
                Web: shop.mileja.ch
            </td>
        </tr>
    </table>

    <!-- TRENNLINIE (Header) -->
    <hr style="color: #aa8684; background-color: #aa8684; height: 1px; border: 0; margin-bottom: 15px;">

    <!-- BELEG INFOS -->
    <table class="info-table">
        <tr>
            <td width="33%">
                <span class="info-label">Belegdatum</span><br>
                {{ formatted_date }}
            </td>
            <td width="33%">
                <span class="info-label">Bedienung</span><br>
                {{ formatted_creator }}
            </td>
            <td width="34%" class="text-right">
                <span class="info-label">Beleg-Nr.</span><br>
                #{{ sale.id }}
            </td>
        </tr>
        <tr>
            <td colspan="3" style="padding-top: 10px;">
                <span class="info-label">Zahlungsmethode:</span>
                {{ sale.get_payment_method_display }}
                {% if sale.transaction_id %}
                    <span style="color: #888; font-size: 8pt;"> (Trx: {{ sale.transaction_id }})</span>
                {% endif %}
            </td>
        </tr>
    </table>

    <!-- ARTIKEL TABELLE -->
    <table class="items-table">
        <thead>
            <tr>
                <th width="5%">Pos.</th> 
                <th width="15%">Art. Nr.</th> 
                <th width="45%">Artikel</th>
                <th width="10%" class="text-center">Menge</th>
                <!-- HIER: Klasse text-right hinzugefügt für Rechtsbündigkeit -->
                <th width="12%" class="text-right">Preis</th> 
                <th width="13%" class="text-right">Total</th> 
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ item.product.sku|default:item.product.ean }}</td>
                <td>{{ item.product.name }}</td>
                <td class="text-center">{{ item.quantity }}</td>
                <td class="text-right">{{ item.unit_price_gross|floatformat:2 }}</td>
                <td class="text-right">{{ item.total_price_gross|floatformat:2 }}</td>
            </tr>
            {% endfor %}
            
            <!-- ABSTAND -->
            <tr>
                <td colspan="6" style="border: none; height: 10px;"></td>
            </tr>

            <!-- ZUSAMMENFASSUNG -->
            <tr class="summary-row">
                <td colspan="5" class="text-right">Netto (exkl. MwSt):</td>
                <td class="text-right">{{ total_cost_net|floatformat:2 }}</td>
            </tr>
            <tr class="summary-row">
                <td colspan="5" class="text-right" style="color: #888; font-size: 8pt;">MwSt ({{ mwst_rate_percent }}%):</td>
                <td class="text-right" style="color: #888; font-size: 8pt;">{{ total_mwst|floatformat:2 }}</td>
            </tr>
            <tr>
                <td colspan="5" class="text-right summary-total-cell" style="border-left: none; border-right: none;">TOTAL CHF</td>
                <td class="text-right summary-total-cell" style="border-left: none; border-right: none;">{{ total_cost_gross|floatformat:2 }}</td>
            </tr>
        </tbody>
    </table>

</body>
</html>