{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Bestellauftrag #{{ order.id }}</title>
    <style>
        /* A4 Page Setup */
        @page {
            size: A4;
            margin: 2cm;
            @frame footer {
                -pdf-frame-content: footer-content;
                bottom: 0cm;
                margin-left: 2cm;
                margin-right: 2cm;
                height: 1cm;
            }
        }
        
        /* MODERN FONT & TYPOGRAPHY */
        body {
            /* Verwenden Sie eine moderne, serifenlose Schriftart */
            font-family: 'Helvetica', 'Roboto', sans-serif;
            font-size: 9pt; /* Kleinere, kompaktere Schrift */
            color: #333;
        }

        /* HEADER & METADATA */
        .header {
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 30px;
            display: flex; /* Nutzung von flex-ähnlichem Verhalten für pisa */
        }
        .logo-box {
            width: 50%;
            float: left;
            font-size: 16pt;
            font-weight: bold;
            color: #004a99; /* Akzentfarbe */
        }
        .metadata-box {
            width: 50%;
            float: right;
            text-align: right;
            font-size: 10pt;
        }
        .title {
            font-size: 24pt;
            font-weight: 300;
            color: #555;
            margin-bottom: 0;
            line-height: 1.2;
        }
        .subtitle {
            font-weight: bold;
            margin-top: 5px;
            color: #004a99;
        }
        .info-block {
            width: 100%;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .address-box {
            width: 45%;
            float: right;
            border-left: 3px solid #ddd;
            padding-left: 15px;
            font-size: 9pt;
        }
        .data-box {
            width: 45%;
            float: left;
            font-size: 9pt;
            line-height: 1.6;
        }
        .data-box strong {
            display: inline-block;
            width: 120px; /* Feste Breite für Beschriftung */
            font-weight: 600;
        }


        /* TABLE STYLING (SIMPLIFIED / BOOKTABS) */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            font-size: 9pt;
        }
        th {
            background-color: white;
            color: #333;
            border-bottom: 2px solid #333; /* Dicke Linie unten */
            padding: 10px 8px;
            text-align: left;
            font-weight: bold;
            text-transform: uppercase;
        }
        td {
            border-bottom: 1px solid #eee; /* Leichte Trennlinie zwischen Zeilen */
            padding: 8px;
            text-align: left;
        }
        
        /* SUMMARY TABLE */
        .summary-table {
            width: 40%;
            float: right;
            margin-top: 20px;
        }
        .summary-row td {
            border: none;
            padding: 3px 0;
        }
        .gross-total-row td {
            font-weight: bold;
            border-top: 1px solid #333; /* Leichte Trennlinie oben */
            border-bottom: 3px double #004a99; /* Doppellinie unten als Abschluss */
            font-size: 10pt;
        }
    </style>
</head>
<body>

    <!-- HEADER BLOCK -->
    <div class="header">
        <div class="logo-box">SupportElle</div>
        <div class="metadata-box">
            <div class="title">BESTELLAUFTRAG</div>
            <div class="subtitle">#{{ order.id }}</div>
        </div>
    </div>
    <div style="clear: both;"></div>


    <!-- INFO & SUPPLIER BLOCK -->
    <div class="info-block">
        
        <!-- Rechter Block: Lieferant (Adresse) -->
        <div class="address-box">
            <p style="font-weight: bold; color: #004a99; margin-bottom: 5px;">LIEFERANT</p>
            <p>{{ order.supplier.name }}<br>
            {% if order.supplier.contact_person %}{{ order.supplier.contact_person }}<br>{% endif %}
            {% if order.supplier.email %}E-Mail: {{ order.supplier.email }}<br>{% endif %}
            {% if order.supplier.website %}Web: {{ order.supplier.website }}{% endif %}</p>
        </div>

        <!-- Linker Block: Bestelldaten -->
        <div class="data-box">
            <p><strong>Datum:</strong> {{ formatted_date }}</p>
            <p><strong>Status:</strong> {{ order.get_status_display }}</p>
            <p><strong>Erstellt von:</strong> {{ formatted_creator }}</p>
        </div>

    </div>
    <div style="clear: both;"></div>
    

    <!-- ITEMS TABLE -->
    <table>
        <thead>
            <tr>
                <!-- POS: 5% -->
                <th style="width: 5%;">Pos.</th> 
                <!-- SKU/EAN: 15% -->
                <th style="width: 15%;">SKU / EAN</th> 
                <!-- Produktbezeichnung: 37% -->
                <th style="width: 37%;">Produktbezeichnung</th>
                <!-- Menge: 10% -->
                <th style="width: 10%; text-align: center;">Menge</th>
                <!-- Preis/Einheit: 17% -->
                <th style="width: 17%; text-align: right;">Preis/Einheit (CHF)</th> 
                <!-- Gesamt: 16% -->
                <th style="width: 16%; text-align: right;">Gesamt (CHF)</th> 
                <!-- Summe der Breiten: 5+15+37+10+17+16 = 100% -->
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ item.product.sku|default:item.product.ean }}</td>
                <td>{{ item.product.name }}</td>
                <td style="text-align: center;">{{ item.quantity }}</td>
                <td style="text-align: right;">{{ item.unit_price|floatformat:2 }} CHF</td>
                <td style="text-align: right;">{{ item.total_price|floatformat:2 }} CHF</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- SUMMARY TABLE -->
    <table class="summary-table">
        <tbody>
            <!-- NETTO Summe -->
            <tr class="summary-row">
                <td style="width: 60%; font-weight: 500;">GESAMTSUMME NETTO (Exkl. MwSt):</td>
                <td style="width: 40%; text-align: right;">{{ total_cost_net|floatformat:2 }} CHF</td>
            </tr>
            
            <!-- MwSt-Zeile -->
            <tr class="summary-row">
                <td style="width: 60%; font-weight: 500;">Enthaltene MwSt. ({{ mwst_rate_percent }}%):</td>
                <td style="width: 40%; text-align: right;">{{ total_mwst|floatformat:2 }} CHF</td>
            </tr>
            
            <!-- BRUTTO Summe -->
            <tr class="gross-total-row">
                <td style="width: 60%; font-weight: bold;">GESAMTSUMME BRUTTO (Inkl. MwSt):</td>
                <td style="width: 40%; text-align: right;">{{ total_cost_gross|floatformat:2 }} CHF</td>
            </tr>
        </tbody>
    </table>
    <div style="clear: both;"></div>


    <!-- FOOTER -->
    <div id="footer-content">
        <hr style="border: none; border-top: 1px solid #ddd;">
        <p style="text-align: center; font-size: 8pt; color: #888;">Stock Keeper GmbH | Bestellwesen | Seite <pdf:pagenumber> von <pdf:pagecount></pdf:pagecount></pdf:pagenumber></p>
    </div>

</body>
</html>